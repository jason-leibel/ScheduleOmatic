/*!
 * vue-gapi v1.1.0
 * (c) 2021 CedricPoilly
 * Released under the MIT License.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VueGapi={})}(this,function(t){"use strict";function i(t){this.clientConfig=(t=t,JSON.parse(JSON.stringify(t))),this.promise=null,this.client=null}function r(t){return{accessToken:t.access_token,idToken:t.id_token,expiresAt:1e3*t.expires_in+Date.now()}}i.prototype.getClientConfig=function(){return this.clientConfig},i.prototype.getClient=function(){var i=this;return null!==this.client?Promise.resolve(this.client):(null===this.promise&&(this.promise=new Promise(function(e,o){var n=document.createElement("script");n.src="https://apis.google.com/js/api.js",n.onreadystatechange=n.onload=function(){var t=setInterval(function(){n.readyState&&!/loaded|complete/.test(n.readyState)||(clearInterval(t),window.gapi?e(window.gapi):o())},100)},n.onerror=function(t,e,n,i,r){o({message:t,url:e,line:n,column:i,error:r})},document.getElementsByTagName("head")[0].appendChild(n)}).then(function(n){return new Promise(function(t,e){n.load("client:auth2",function(){n.client.init(i.clientConfig).then(function(){i.client={gapi:n,authInstance:n.auth2.getAuthInstance()},t(i.client)},e)})})})),this.promise)};function o(t,e){this.clientProvider=t,this.sessionStorage=e}o.prototype.getGapiClient=function(){return this.clientProvider.getClient().then(function(t){return t.gapi})},o.prototype.getAuthInstance=function(){return this.clientProvider.getClient().then(function(t){return t.authInstance})},o.prototype.getCurrentUser=function(){return this.getAuthInstance().then(function(t){return t.currentUser.get()})},o.prototype.getOfflineAccessCode=function(){return this.sessionStorage.getItem("offlineAccessCode")},o.prototype.grantOfflineAccess=function(){var e=this;return this.getAuthInstance().grantOfflineAccess().then(function(t){t=t.code;return e.sessionStorage.setItem("offlineAccessCode",t),t})},o.prototype.hasGrantedRequestedScopes=function(t){var e=this.clientProvider.getClientConfig().scope;return!e||t.hasGrantedScopes(e)},o.prototype.login=function(t){var i=this;void 0===t&&(t={});var n=t.grantOfflineAccess;return void 0===n&&(n=!1),this.getAuthInstance().then(function(t){return t.signIn().then(function(t){var e,n;return i.sessionStorage.set((n=r((e=t).getAuthResponse(!0)),(e=e.getBasicProfile())&&(n.id=e.getId(),n.fullName=e.getName(),n.firstName=e.getGivenName(),n.lastName=e.getFamilyName(),n.email=e.getEmail(),n.imageUrl=e.getImageUrl()),n)),{currentUser:t,hasGrantedScopes:i.hasGrantedRequestedScopes(t)}})}).then(function(e){return n?i.grantOfflineAccess().then(function(t){return Object.assign({},e,{code:t})}):e})},o.prototype.refreshToken=function(){var e=this;return this.getCurrentUser().then(function(t){return t.reloadAuthResponse()}).then(function(t){return e.sessionStorage.set(Object.assign({},e.sessionStorage.get(),r(t))),t})},o.prototype.grant=function(){var n=this;return this.getCurrentUser().then(function(t){if(n.hasGrantedRequestedScopes(t))return t;var e=n.clientProvider.getClientConfig().scope;return t.grant({scope:e}).then(function(){return t})})},o.prototype.logout=function(){var t=this;return this.getAuthInstance().then(function(t){return t.signOut()}).then(function(){return t.sessionStorage.clear()})},o.prototype.isAuthenticated=function(){return(new Date).getTime()<this.sessionStorage.getItem("expiresAt")},o.prototype.isSignedIn=function(){return this.getCurrentUser().then(function(t){return t.isSignedIn()})},o.prototype.listenUserSignIn=function(e){return this.getAuthInstance().then(function(t){e(t.currentUser.get().isSignedIn()),t.isSignedIn.listen(e)})},o.prototype.getUserData=function(){return this.sessionStorage.get()};function s(t){void 0===t&&(t=window.localStorage),this.localStorage=t}var e="gapi.session";s.prototype.set=function(t){this.localStorage.setItem(e,JSON.stringify(t))},s.prototype.setItem=function(t,e){var n=this.get()||{};n[t]=e,this.set(n)},s.prototype.get=function(){return JSON.parse(this.localStorage.getItem(e))},s.prototype.getItem=function(t){return(this.get()||{})[t]},s.prototype.clear=function(){this.localStorage.removeItem(e)};var n={install:function(t,e){var n=new i(e),e=new s;t.prototype.$gapi=new o(n,e)}};t.default=n,t.version="1.1.0",Object.defineProperty(t,"__esModule",{value:!0})});